

## Day7

假设有两个节点做replication，为了避免分别向两个节点同时做写的操作
许多资料系统都只允许在一个节点上做写额操作。如果有partition, 那么每个partition内只会有一个
master，以及0-多个slave，只有master能写资料。
再极端一点，只允许master上读取资料，那么replica完全充当背媛的角色，没有分散读取的能力


## Day 8 eventual consistency

只要资料不再更新，最终有一个时刻，所有的节点会协调处一个一致的状态

每个节点的时间并不能同步，所以不能得到全局的顺序，所以不是很可靠。但是舍弃掉strong consistency可以换取其他的特性。

## Day 9 CAP

幸福三选二 (一般倾向保留P)

C: Consistency: 任何时候，两个节点的到的状态都是一样的
A: Availability: 若一个节点正常活动，那么它就必须能够正常服务
P: Partition: 若因为网络问题或者节点故障，切割成两个不完整的sub cluster， 系统依旧能够正常运行


在发生partition的时候，应该怎么做

1. keep avilability: 如果依旧各自正常工作，会出现brain split, 保证（A P）

2. keep consistency: 为了避免不一致的问题，biubiu停掉其中一个节点 保证 （C P ）


## Chapter 10 in memory data

如何能够让ram里的内容断电以后不会不见呢

1. persistence
2. replication


## Chapter 11 zookeeper

1. 共享 metadata
2. 监控成员节点的状况 & 维护丛集的成员名单
3. 协助选出丛集中的leader(master)

ZK的资料是树状结构的，节点叫做znode,可以在里面放置资料

再理解:
```
有一种 znode 叫做 ephemeral node，用来监控成员的状况。这个 znode 跟建立 znode 的
成员的 session 状况是连动的，若 session 一段时间没有回报 (heartbeat)，这个 znode
节点就会被删除。因此若有其他成员在此 znode 上设定 watcher，就会在此节点挂掉 (即
session 挂掉时) 收到通知。
所有成员都会对 master 对应的 ephemeral node 注册 watcher，所以在 master 失效後，会
有成员侦测到而启动 leader election。

```

## Day 12 Zookeeper

为了能够保证global order, 只有Leader能够写入要求。采用了Quorum,在partition的时候仍旧能够维持服务。

采用了偏向CA的系统 ？？

ZK成员有两种角色：leader 或者follower。
一个Quroum最多只有一个leader，其他都是支持这个leader的followers.

leader election的目的就是选出Quorum中的leader
一个Quorum钟的成员数达到最低的投票标准，一般来说，是要大于ZK的节点数目的一半
eg: 一共5个节点，那么Quorum必须要有三个成员，所以
当发生partition的时候，其中一个的partition是不足以形成quorum，所以不能够对外服务
所以整个cluster只有一个quoroum，所以不会发生inconsistency的问题。




## Day 13 Kafka

distributed queue,很多
streaming平台都把他作为data source

特点：
* 分散式架构
* 基于磁盘空间，并且避免随机存取
* 因为存储空间大，queue的资料已经消耗也可以不用删除掉
  * 其他新加入的consumer可以读取过去的资料
  * 如果有batch-oriented的consumer，可以一次拉去足够大量的资料
 
* 对资料的包装是轻量级的，可以压缩。
* 因为可以直接处理档案资料，直接用 OS 的 page cache，不需要额外 Applicaion
Cache 来竞争珍贵的记忆体空间。 ？？


## Day 14 Kafka

kafka是一个broker角色，位于producer consumer中间，一般是一个多节点的cluster

一组资料流称为一个topic, 避免topic 资料过大，一个topic可以分成好几个

partition，每个partition会在不用的节点上

每个producer要决定将那个资料送到哪个partition。

有一个api可以指定partition key， 然后使用hash的方式确定partition


两种queue mode:
1. point to point
2. pub/sub

一个重点
是





#### Reference: 
http://dcaoyuan.github.io/papers/pdfs/Scalability.pdf







